<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatoClín: Conexiones Clínicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
        
        body {
            font-family: 'Fredoka One', cursive;
            background: linear-gradient(180deg, #fcd3e7 0%, #a3d5ff 100%);
            min-height: 100vh;
            color: #d6336c; /* Color de texto principal estilo Kirby (rosa fuerte) */
            overflow-x: hidden;
        }

        .kirby-panel {
            background-color: rgba(255, 255, 255, 0.8);
            border: 4px solid #fff;
            border-radius: 2rem;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            backdrop-filter: blur(4px);
        }
        
        .kirby-button {
            border-radius: 9999px;
            border: 3px solid #fff;
            box-shadow: 0 6px 0 rgba(0,0,0,0.15);
            transition: all 0.1s ease-in-out;
            color: white; /* Botones con texto blanco para contraste */
        }

        .kirby-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 rgba(0,0,0,0.15);
        }

        .kirby-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.15);
        }

        .card {
            perspective: 1000px;
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-5px) scale(1.03);
        }
        
        .card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 1.5rem;
            border: 4px solid white;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
        }
        
        .card-front.disease {
             background: linear-gradient(135deg, #ffd166, #ff9f1c);
        }

        .card-front.risk {
             background: linear-gradient(135deg, #ff99c8, #f372b2);
        }

        .card-back.disease {
            background-color: #fffac8;
            transform: rotateY(180deg);
        }

        .card-back.risk {
            background-color: #ffe5ec;
            transform: rotateY(180deg);
        }
        
        .card-text-outline {
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
        }

        .matched {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .highlight {
            animation: pulse-glow 1s ease-in-out;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 15px 5px rgba(255, 255, 150, 0.7); }
            50% { box-shadow: 0 0 25px 10px rgba(255, 255, 150, 1); }
            100% { box-shadow: 0 0 15px 5px rgba(255, 255, 150, 0.7); }
        }
        
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .team-indicator.active {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }
        
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-2">
        <header class="text-center mb-2">
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold" style="color: white; text-shadow: 3px 3px 0px #ff8fab;">Conexiones</h1>
            <p class="text-sm sm:text-base">Empareja patologías con sus factores de riesgo prevenibles</p>
            <p class="text-xs sm:text-sm">Creado por: M.C. Adriana Alicia Barrios Rodríguez</p>
        </header>
        
        <!-- Configuración de equipos -->
        <div id="team-setup" class="max-w-md mx-auto kirby-panel p-6 my-8 slide-in">
            <h2 class="text-2xl font-bold mb-4 text-center">Configuración de Equipos</h2>
            <div class="mb-4">
                <label for="team1-name" class="block mb-2 font-bold">Integrantes del Equipo 1:</label>
                <input type="text" id="team1-name" class="w-full px-4 py-2 rounded-full bg-white/80 border-4 border-white focus:outline-none focus:ring-4 focus:ring-pink-300" placeholder="Equipo 1" value="Equipo 1">
            </div>
            <div class="mb-6">
                <label for="team2-name" class="block mb-2 font-bold">Integrantes del Equipo 2:</label>
                <input type="text" id="team2-name" class="w-full px-4 py-2 rounded-full bg-white/80 border-4 border-white focus:outline-none focus:ring-4 focus:ring-blue-300" placeholder="Equipo 2" value="Equipo 2">
            </div>
            <div class="flex gap-4">
                <button id="start-game-btn" class="kirby-button flex-1 py-3 bg-gradient-to-b from-green-400 to-green-500 font-bold text-lg">Comenzar Juego</button>
            </div>
        </div>
        
        <!-- Juego principal (oculto inicialmente) -->
        <div id="game-container" class="hidden">
            <!-- Panel Superior Combinado -->
            <div class="flex flex-col lg:flex-row gap-2 mb-2">
                <!-- Panel de Instrucciones -->
                <div class="w-full lg:w-1/2 kirby-panel p-3">
                    <h2 class="text-lg font-bold mb-1">Instrucciones</h2>
                    <ul class="list-disc pl-5 space-y-0.5 text-xs">
                        <li>Encuentra los pares de patologías y sus factores de riesgo.</li>
                        <li>Cada equipo tiene un tiempo limitado por turno.</li>
                        <li>Si aciertan un par, ganan puntos y tiempo extra. Si fallan, cambia el turno.</li>
                    </ul>
                </div>
                <!-- Panel de Dificultad -->
                <div class="w-full lg:w-1/4 kirby-panel p-3">
                    <h3 class="text-lg font-semibold mb-1">Dificultad</h3>
                    <div class="flex flex-col gap-1">
                        <button id="easy-btn" class="kirby-button w-full px-2 py-1.5 text-sm bg-green-300 hover:bg-green-400">Fácil</button>
                        <button id="medium-btn" class="kirby-button w-full px-2 py-1.5 text-sm bg-blue-400 hover:bg-blue-500">Intermedio</button>
                        <button id="hard-btn" class="kirby-button w-full px-2 py-1.5 text-sm bg-pink-400 hover:bg-pink-500">Difícil</button>
                    </div>
                </div>
                 <!-- Panel de Reinicio -->
                <div class="w-full lg:w-1/4 kirby-panel p-3 flex items-center justify-center">
                    <button id="restart-btn" class="kirby-button w-full h-full py-3 bg-gradient-to-b from-yellow-400 to-orange-500 font-bold flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                        Reiniciar
                    </button>
                </div>
            </div>

            <!-- Información del juego -->
            <div class="kirby-panel p-2 sm:p-3 mb-2">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-4">
                    <div class="flex items-center">
                        <span class="text-sm sm:text-base font-semibold">Turno: <span id="timer" class="font-bold text-lg">00:30</span></span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-sm sm:text-base font-semibold">Total: <span id="total-score" class="font-bold text-lg">0</span></span>
                    </div>
                    <div class="flex items-center">
                        <span id="pairs" class="text-sm sm:text-base font-semibold">0/16</span>
                    </div>
                </div>
                <div class="w-full bg-white/50 rounded-full h-4 mt-2 mb-1.5 border-2 border-white">
                    <div id="progress-bar" class="progress-bar bg-gradient-to-r from-green-400 to-blue-400 h-full rounded-full" style="width: 100%"></div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    <div id="team1-indicator" class="team-indicator active bg-pink-300/80 rounded-2xl p-1.5 text-center border-2 border-white">
                        <h3 id="team1-name-display" class="font-semibold text-xs truncate text-white">Equipo 1</h3>
                        <div class="flex justify-between text-[10px] text-white/90"><span>Puntos: <span id="team1-score">0</span></span><span>Aciertos: <span id="team1-matches">0</span></span></div>
                    </div>
                    <div id="team2-indicator" class="team-indicator bg-blue-300/80 rounded-2xl p-1.5 text-center border-2 border-white">
                        <h3 id="team2-name-display" class="font-semibold text-xs truncate text-white">Equipo 2</h3>
                        <div class="flex justify-between text-[10px] text-white/90"><span>Puntos: <span id="team2-score">0</span></span><span>Aciertos: <span id="team2-matches">0</span></span></div>
                    </div>
                </div>
            </div>
            
            <!-- Tablero de juego -->
            <div id="game-board" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 xl:grid-cols-10 gap-3 sm:gap-4"></div>
        </div>
    </div>
    
    <!-- Modal de victoria -->
    <div id="win-modal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black/70 p-4">
        <div class="kirby-panel p-6 sm:p-8 max-w-2xl w-full mx-auto relative">
            <div class="text-center relative z-10">
                <h2 class="text-3xl sm:text-4xl font-bold mb-2" style="color: #22c55e;">¡Juego Completado!</h2>
                <p class="text-lg sm:text-xl mb-6">Reporte de resultados</p>
                
                <div class="bg-white/50 rounded-2xl p-4 sm:p-6 mb-6 text-left">
                    <h3 class="text-xl sm:text-2xl font-bold text-center mb-4">
                        <span id="winner-team">Equipo Ganador</span>
                        <span class="ml-2">🏆</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                        <div class="bg-pink-100/50 rounded-xl p-4 border-2 border-white">
                            <h4 id="team1-result-name" class="font-bold text-lg mb-2 text-center truncate">Equipo 1</h4>
                            <div class="space-y-2 text-sm sm:text-base">
                                <div class="flex justify-between"><span>Puntuación:</span><span id="team1-final-score" class="font-semibold">0</span></div>
                                <div class="flex justify-between"><span>Pares:</span><span id="team1-final-matches" class="font-semibold">0</span></div>
                                <div class="flex justify-between"><span>Fallos:</span><span id="team1-final-misses" class="font-semibold">0</span></div>
                                <div class="flex justify-between"><span>Precisión:</span><span id="team1-final-accuracy" class="font-semibold">0%</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-100/50 rounded-xl p-4 border-2 border-white">
                            <h4 id="team2-result-name" class="font-bold text-lg mb-2 text-center truncate">Equipo 2</h4>
                            <div class="space-y-2 text-sm sm:text-base">
                                <div class="flex justify-between"><span>Puntuación:</span><span id="team2-final-score" class="font-semibold">0</span></div>
                                <div class="flex justify-between"><span>Pares:</span><span id="team2-final-matches" class="font-semibold">0</span></div>
                                <div class="flex justify-between"><span>Fallos:</span><span id="team2-final-misses" class="font-semibold">0</span></div>
                                <div class="flex justify-between"><span>Precisión:</span><span id="team2-final-accuracy" class="font-semibold">0%</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-sm sm:text-base">
                        <div class="flex justify-between">
                            <span>Nivel:</span>
                            <span id="win-level" class="font-semibold">Intermedio</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="download-report-btn" class="kirby-button flex-1 py-3 bg-blue-400 font-bold">Descargar Reporte</button>
                    <button id="play-again-btn" class="kirby-button flex-1 py-3 bg-green-400 font-bold">Jugar de nuevo</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Datos del juego
            const easyPairs = [
                { disease: "Diabetes mellitus tipo 2", risk: "Dieta rica en azúcares refinados" },
                { disease: "Hipertensión arterial", risk: "Consumo excesivo de sal" },
                { disease: "Cáncer de pulmón", risk: "Tabaquismo activo" },
                { disease: "Osteoporosis", risk: "Sedentarismo" },
                { disease: "Caries dental", risk: "Consumo frecuente de bebidas azucaradas" },
                { disease: "Anemia ferropénica", risk: "Dieta pobre en hierro" },
                { disease: "Obesidad", risk: "Consumo excesivo de alimentos ultraprocesados" },
                { disease: "Asma", risk: "Exposición a alérgenos domésticos" },
                { disease: "Enfermedad coronaria", risk: "Dieta alta en grasas saturadas" },
                { disease: "Cirrosis hepática", risk: "Consumo crónico de alcohol" },
                { disease: "Melanoma", risk: "Exposición solar sin protección" },
                { disease: "Gastritis", risk: "Consumo frecuente de alimentos irritantes" }
            ];
            
            const mediumPairs = [
                { disease: "Diabetes mellitus tipo 2", risk: "Sobrepeso y obesidad abdominal" },
                { disease: "Hipertensión arterial", risk: "Dieta DASH no adherida" },
                { disease: "Cáncer de pulmón", risk: "Exposición a humo de segunda mano" },
                { disease: "Osteoporosis", risk: "Baja ingesta de calcio y vitamina D" },
                { disease: "Enfermedad periodontal", risk: "Técnica de cepillado inadecuada" },
                { disease: "Anemia ferropénica", risk: "Consumo insuficiente de alimentos ricos en hierro" },
                { disease: "Enfermedad por reflujo gastroesofágico", risk: "Comidas copiosas antes de acostarse" },
                { disease: "Síndrome metabólico", risk: "Estilo de vida sedentario" },
                { disease: "Enfermedad pulmonar obstructiva crónica", risk: "Exposición ocupacional a polvos y químicos" },
                { disease: "Accidente cerebrovascular", risk: "Hipertensión no controlada" },
                { disease: "Cáncer colorrectal", risk: "Dieta baja en fibra y alta en carnes procesadas" },
                { disease: "Depresión", risk: "Aislamiento social prolongado" },
                { disease: "Infarto agudo de miocardio", risk: "Tabaquismo y dislipidemia" },
                { disease: "Esteatosis hepática no alcohólica", risk: "Dieta hipercalórica rica en fructosa" },
                { disease: "Cáncer de piel", risk: "Quemaduras solares repetidas" },
                { disease: "Insomnio crónico", risk: "Uso de pantallas antes de dormir" }
            ];
            
            const hardPairs = [
                { disease: "Diabetes mellitus tipo 2", risk: "Índice glucémico elevado en la dieta habitual" },
                { disease: "Hipertensión arterial resistente", risk: "Apnea obstructiva del sueño no tratada" },
                { disease: "Cáncer de pulmón de células pequeñas", risk: "Exposición ocupacional a asbesto y radón" },
                { disease: "Osteoporosis severa", risk: "Consumo excesivo de bebidas carbonatadas" },
                { disease: "Periodontitis avanzada", risk: "Tabaquismo y control glucémico deficiente" },
                { disease: "Anemia megaloblástica", risk: "Dieta vegana estricta sin suplementación" },
                { disease: "Enfermedad de Crohn", risk: "Tabaquismo activo y dieta occidental" },
                { disease: "Síndrome coronario agudo", risk: "Estrés psicosocial crónico no manejado" },
                { disease: "EPOC estadio avanzado", risk: "Exposición a biomasa en espacios mal ventilados" },
                { disease: "Ictus isquémico", risk: "Fibrilación auricular no anticoagulada" },
                { disease: "Cáncer de colon estadio III", risk: "Consumo habitual de carnes procesadas y ahumadas" },
                { disease: "Trastorno depresivo mayor", risk: "Privación crónica de sueño" },
                { disease: "Insuficiencia cardíaca congestiva", risk: "Hipertensión no controlada y obesidad" },
                { disease: "Esteatohepatitis no alcohólica", risk: "Síndrome metabólico no tratado" },
                { disease: "Melanoma metastásico", risk: "Exposición intensa intermitente a rayos UV" },
                { disease: "Enfermedad renal crónica", risk: "Uso prolongado de antiinflamatorios no esteroideos" },
                { disease: "Demencia vascular", risk: "Factores de riesgo cardiovascular no controlados" },
                { disease: "Artritis reumatoide", risk: "Tabaquismo y predisposición genética" },
                { disease: "Cáncer gástrico", risk: "Infección por H. pylori no tratada y dieta alta en sal" },
                { disease: "Osteoartritis de rodilla", risk: "Obesidad y actividades de alto impacto articular" }
            ];
            
            // Constantes del temporizador
            const TURN_TIME = 30; // 30 segundos por turno
            const BONUS_TIME = 15; // 15 segundos de bonificación por acierto

            // Variables del juego
            let currentPairs = mediumPairs;
            let cards = [];
            let flippedCards = [];
            let matchedPairs = 0;
            let totalScore = 0;
            let turnTimer;
            let turnTimeLeft = TURN_TIME;
            let gameActive = false;
            let difficulty = 'medium';
            
            // Variables de equipos
            let currentTeam = 1; 
            let team1 = { name: "Equipo 1", score: 0, matches: 0, misses: 0 };
            let team2 = { name: "Equipo 2", score: 0, matches: 0, misses: 0 };
            
            // Elementos DOM
            const teamSetup = document.getElementById('team-setup');
            const gameContainer = document.getElementById('game-container');
            const gameBoard = document.getElementById('game-board');
            const timerElement = document.getElementById('timer');
            const totalScoreElement = document.getElementById('total-score');
            const pairsElement = document.getElementById('pairs');
            const progressBar = document.getElementById('progress-bar');
            const restartBtn = document.getElementById('restart-btn');
            const easyBtn = document.getElementById('easy-btn');
            const mediumBtn = document.getElementById('medium-btn');
            const hardBtn = document.getElementById('hard-btn');
            const winModal = document.getElementById('win-modal');
            const playAgainBtn = document.getElementById('play-again-btn');
            const downloadReportBtn = document.getElementById('download-report-btn');
            
            const team1NameInput = document.getElementById('team1-name');
            const team2NameInput = document.getElementById('team2-name');
            const startGameBtn = document.getElementById('start-game-btn');
            const team1Indicator = document.getElementById('team1-indicator');
            const team2Indicator = document.getElementById('team2-indicator');
            const team1NameDisplay = document.getElementById('team1-name-display');
            const team2NameDisplay = document.getElementById('team2-name-display');
            const team1ScoreDisplay = document.getElementById('team1-score');
            const team2ScoreDisplay = document.getElementById('team2-score');
            const team1MatchesDisplay = document.getElementById('team1-matches');
            const team2MatchesDisplay = document.getElementById('team2-matches');
            
            startGameBtn.addEventListener('click', () => {
                team1.name = team1NameInput.value || "Equipo 1";
                team2.name = team2NameInput.value || "Equipo 2";
                team1NameDisplay.textContent = team1.name;
                team2NameDisplay.textContent = team2.name;
                teamSetup.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                gameContainer.classList.add('fade-in');
                initGame();
            });
            
            function initGame() {
                resetGame();
                createCards();
                startTurn();
                gameActive = true;
            }
            
            function resetGame() {
                gameBoard.innerHTML = '';
                flippedCards = [];
                matchedPairs = 0;
                totalScore = 0;
                team1 = { ...team1, score: 0, matches: 0, misses: 0 };
                team2 = { ...team2, score: 0, matches: 0, misses: 0 };
                currentTeam = Math.random() < 0.5 ? 1 : 2;
                
                if (difficulty === 'easy') currentPairs = easyPairs;
                else if (difficulty === 'medium') currentPairs = mediumPairs;
                else currentPairs = hardPairs;
                
                clearInterval(turnTimer);
                updateUI();
            }

            function startTurn() {
                turnTimeLeft = TURN_TIME;
                updateTeamIndicators();
                startTurnTimer();
            }

            function switchTurn() {
                currentTeam = currentTeam === 1 ? 2 : 1;
                clearInterval(turnTimer);
                startTurn();
            }
            
            function createCards() {
                cards = [];
                currentPairs.forEach(pair => {
                    cards.push({ id: generateId(), type: 'disease', content: pair.disease, match: pair.risk });
                    cards.push({ id: generateId(), type: 'risk', content: pair.risk, match: pair.disease });
                });
                shuffleArray(cards);
                
                cards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card aspect-[4/3] cursor-pointer';
                    cardElement.dataset.id = card.id;
                    cardElement.innerHTML = `
                        <div class="card-inner w-full h-full relative">
                            <div class="card-front ${card.type} absolute w-full h-full flex items-center justify-center p-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-1/2 h-1/2 text-white" viewBox="0 0 20 20" fill="currentColor">
                                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                </svg>
                            </div>
                            <div class="card-back ${card.type} absolute w-full h-full flex flex-col items-center justify-center p-2 text-center">
                                <span class="card-text-outline font-bold text-xs sm:text-sm xl:text-base">${card.content}</span>
                            </div>
                        </div>`;
                    cardElement.addEventListener('click', () => flipCard(cardElement, card));
                    gameBoard.appendChild(cardElement);
                });
            }
            
            function flipCard(cardElement, card) {
                if (!gameActive || flippedCards.length >= 2 || cardElement.classList.contains('flipped') || cardElement.classList.contains('matched')) {
                    return;
                }
                cardElement.classList.add('flipped');
                flippedCards.push({ element: cardElement, card: card });
                if (flippedCards.length === 2) {
                    gameActive = false; // Bloquear más clics mientras se verifica
                    setTimeout(checkMatch, 800);
                }
            }
            
            function checkMatch() {
                const [card1, card2] = flippedCards;
                const currentTeamObj = currentTeam === 1 ? team1 : team2;
                
                if (card1.card.match === card2.card.content) {
                    card1.element.classList.add('matched');
                    card2.element.classList.add('matched');
                    card1.element.classList.add('highlight');
                    card2.element.classList.add('highlight');
                    setTimeout(() => {
                        card1.element.classList.remove('highlight');
                        card2.element.classList.remove('highlight');
                    }, 1000);
                    
                    matchedPairs++;
                    let points = difficulty === 'hard' ? 100 : difficulty === 'medium' ? 75 : 50;
                    points += Math.floor(turnTimeLeft / 2); // Bonus por tiempo restante en el turno
                    currentTeamObj.score += points;
                    currentTeamObj.matches++;
                    totalScore += points;
                    
                    turnTimeLeft += BONUS_TIME; // Añadir tiempo extra
                    
                    if (matchedPairs === currentPairs.length) {
                        gameWon();
                    }
                } else {
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    currentTeamObj.misses++;
                    switchTurn();
                }
                
                updateUI();
                flippedCards = [];
                gameActive = true; // Desbloquear clics
            }
            
            function updateTeamIndicators() {
                if (currentTeam === 1) {
                    team1Indicator.classList.add('active');
                    team2Indicator.classList.remove('active');
                } else {
                    team1Indicator.classList.remove('active');
                    team2Indicator.classList.add('active');
                }
                team1ScoreDisplay.textContent = team1.score;
                team2ScoreDisplay.textContent = team2.score;
                team1MatchesDisplay.textContent = team1.matches;
                team2MatchesDisplay.textContent = team2.matches;
            }
            
            function startTurnTimer() {
                clearInterval(turnTimer);
                turnTimer = setInterval(() => {
                    turnTimeLeft--;
                    updateTimerUI();
                    if (turnTimeLeft <= 0) {
                        clearInterval(turnTimer);
                        (currentTeam === 1 ? team1 : team2).misses++;
                        flippedCards.forEach(c => c.element.classList.remove('flipped'));
                        flippedCards = [];
                        switchTurn();
                    }
                }, 1000);
            }

            function updateTimerUI() {
                const minutes = Math.floor(turnTimeLeft / 60);
                const seconds = turnTimeLeft % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const percentage = (turnTimeLeft / TURN_TIME) * 100;
                progressBar.style.width = `${percentage}%`;
                
                if (percentage < 25) progressBar.className = 'progress-bar bg-red-400 h-full rounded-full';
                else if (percentage < 50) progressBar.className = 'progress-bar bg-yellow-400 h-full rounded-full';
                else progressBar.className = 'progress-bar bg-gradient-to-r from-green-400 to-blue-400 h-full rounded-full';
            }
            
            function updateUI() {
                updateTimerUI();
                totalScoreElement.textContent = totalScore;
                pairsElement.textContent = `${matchedPairs}/${currentPairs.length}`;
                updateTeamIndicators();
            }
            
            function gameWon() {
                gameActive = false;
                clearInterval(turnTimer);
                const winner = team1.score > team2.score ? team1.name : team2.score > team1.score ? team2.name : "¡Empate!";
                
                document.getElementById('winner-team').textContent = winner;
                document.getElementById('win-level').textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
                
                ['team1', 'team2'].forEach(team => {
                    const teamObj = team === 'team1' ? team1 : team2;
                    document.getElementById(`${team}-result-name`).textContent = teamObj.name;
                    document.getElementById(`${team}-final-score`).textContent = teamObj.score;
                    document.getElementById(`${team}-final-matches`).textContent = teamObj.matches;
                    document.getElementById(`${team}-final-misses`).textContent = teamObj.misses;
                    const accuracy = teamObj.matches + teamObj.misses > 0 ? `${Math.round((teamObj.matches / (teamObj.matches + teamObj.misses)) * 100)}%` : "0%";
                    document.getElementById(`${team}-final-accuracy`).textContent = accuracy;
                });
                
                setTimeout(() => winModal.classList.add('active'), 1000);
            }
            
            
            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(22);
                doc.setTextColor(0, 51, 102);
                doc.text("Reporte de Resultados - Conexión Clínica", 105, 20, { align: "center" });
                
                const now = new Date();
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Fecha: ${now.toLocaleDateString()} - Hora: ${now.toLocaleTimeString()}`, 105, 30, { align: "center" });
                
                doc.setDrawColor(0, 51, 102);
                doc.setLineWidth(0.5);
                doc.line(20, 35, 190, 35);
                
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text("Información del Juego", 20, 45);
                
                doc.setFontSize(12);
                doc.text(`Nivel de dificultad: ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}`, 25, 55);
                doc.text(`Pares encontrados: ${matchedPairs}/${currentPairs.length}`, 25, 65);
                
                const winner = team1.score > team2.score ? team1.name : team2.score > team1.score ? team2.name : "¡Empate!";
                doc.setFontSize(16);
                doc.setTextColor(0, 102, 0);
                doc.text(`Equipo ganador: ${winner}`, 105, 80, { align: "center" });
                
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text("Resultados por Equipo", 20, 95);
                
                const team1accuracy = team1.matches + team1.misses > 0 ? Math.round((team1.matches / (team1.matches + team1.misses)) * 100) : 0;
                doc.setFontSize(12);
                doc.setTextColor(0, 51, 153);
                doc.text(`${team1.name}:`, 25, 105);
                doc.setTextColor(0, 0, 0);
                doc.text(`Puntuación: ${team1.score}`, 35, 115);
                doc.text(`Pares encontrados: ${team1.matches}`, 35, 125);
                doc.text(`Intentos fallidos: ${team1.misses}`, 35, 135);
                doc.text(`Precisión: ${team1accuracy}%`, 35, 145);
                
                const team2accuracy = team2.matches + team2.misses > 0 ? Math.round((team2.matches / (team2.matches + team2.misses)) * 100) : 0;
                doc.setFontSize(12);
                doc.setTextColor(102, 0, 153);
                doc.text(`${team2.name}:`, 120, 105);
                doc.setTextColor(0, 0, 0);
                doc.text(`Puntuación: ${team2.score}`, 130, 115);
                doc.text(`Pares encontrados: ${team2.matches}`, 130, 125);
                doc.text(`Intentos fallidos: ${team2.misses}`, 130, 135);
                doc.text(`Precisión: ${team2accuracy}%`, 130, 145);
                
                doc.setDrawColor(0, 51, 102);
                doc.setLineWidth(0.5);
                doc.line(20, 160, 190, 160);
                
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text("© Patología Clínica - Juego educativo por M.C. Adriana Alicia Barrios Rodríguez", 105, 280, { align: "center" });
                
                doc.save("Reporte_Conexion_Clinica.pdf");
            }
            
            function generateId() { return Math.random().toString(36).substring(2, 15); }
            function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
            
            restartBtn.addEventListener('click', initGame);
            
            [easyBtn, mediumBtn, hardBtn].forEach(btn => {
                btn.addEventListener('click', (e) => {
                    difficulty = e.target.id.replace('-btn', '');
                    [easyBtn, mediumBtn, hardBtn].forEach(b => {
                        b.classList.remove('bg-green-400', 'bg-blue-400', 'bg-pink-400');
                        b.classList.add('bg-green-300');
                    });
                    e.target.classList.remove('bg-green-300');
                    e.target.classList.add(`bg-${e.target.id.includes('easy') ? 'green' : e.target.id.includes('medium') ? 'blue' : 'pink'}-400`);
                    initGame();
                });
            });
            
            playAgainBtn.addEventListener('click', () => {
                winModal.classList.remove('active');
                initGame();
            });
            
            downloadReportBtn.addEventListener('click', generatePDF);
        });
    </script>
</body>
</html>
